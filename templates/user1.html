<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrishiSetu - User Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #4CAF50;
            --secondary-color: #388E3C;
            --accent-color: #FFC107;
            --text-color: #333;
            --light-color: #f9f9f9;
            --dark-color: #212121;
            --gray-color: #f0f0f0;
            --border-color: #ddd;
            --danger-color: #f44336;
            --success-color: #8BC34A;
            --info-color: #2196F3;
            --warning-color: #FF9800;
        }

        body {
            background-color: var(--light-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            height: 35px;
            margin-right: 10px;
        }

        .logo h1 {
            color: var(--primary-color);
            font-size: 24px;
            font-weight: 700;
        }

        .nav-links {
            display: flex;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            margin-left: 20px;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--primary-color);
        }

        .user-menu {
            position: relative;
            margin-left: 20px;
        }

        .user-icon {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-icon span {
            margin-left: 8px;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            width: 200px;
            padding: 10px 0;
            display: none;
            z-index: 1000;
        }

        .dropdown-menu.active {
            display: block;
        }

        .dropdown-menu a {
            display: block;
            padding: 10px 20px;
            color: var(--text-color);
            text-decoration: none;
            transition: background-color 0.3s ease;
        }

        .dropdown-menu a:hover {
            background-color: var(--gray-color);
            color: var(--primary-color);
        }

        .hamburger {
            display: none;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 24px;
        }

        /* Main Content */
        main {
            padding-top: 80px;
            min-height: calc(100vh - 200px);
        }

        /* Content Area */
        .content-area {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 25px;
        }

        .welcome-section {
            margin-bottom: 30px;
        }

        .welcome-section h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        /* Dashboard Cards */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .card-icon {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .card h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .card p {
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .card-link {
            display: inline-block;
            color: var(--primary-color);
            font-weight: 500;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .card-link:hover {
            color: var(--secondary-color);
        }

        .trend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .trend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            padding: 5px;
            border-radius: 4px;
            transition: transform 0.2s ease, background-color 0.2s ease;
            position: relative;
        }

        .trend-item:hover {
            transform: scale(1.05);
            background-color: var(--gray-color);
        }

        .trend-item span {
            margin-right: 5px;
        }

        .trending-up {
            color: var(--success-color);
        }

        .trending-down {
            color: var(--danger-color);
        }

        .trending-stable {
            color: #757575;
        }

        .trend-tooltip {
            visibility: hidden;
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark-color);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
        }

        .trend-item:hover .trend-tooltip {
            visibility: visible;
        }

        /* Products Section */
        .products-section {
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .view-all {
            color: var(--primary-color);
            font-weight: 500;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .view-all:hover {
            color: var(--secondary-color);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            position: relative;
            height: 150px;
            background-color: var(--gray-color);
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent-color);
            color: var(--dark-color);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .product-details {
            padding: 15px;
        }

        .product-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .product-farm {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 10px;
        }

        .product-price {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price {
            font-weight: 600;
            color: var(--secondary-color);
        }

        .product-actions {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
        }

        .btn {
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-cancel {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-cancel:hover {
            background-color: #d32f2f;
        }

        .btn-cancel-order {
            background-color: var(--danger-color);
            color: white;
            margin-top: 15px;
        }

        .btn-cancel-order:hover {
            background-color: #d32f2f;
        }

        /* Market Prices Section */
        .market-prices {
            margin-bottom: 30px;
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
        }

        .price-table th, .price-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .price-table th {
            background-color: var(--gray-color);
            font-weight: 600;
            color: var(--secondary-color);
        }

        .price-table tr:hover {
            background-color: var(--light-color);
        }

        /* Detailed Analysis, Track Order, and Cart Details Sections */
        .detailed-section {
            display: none;
            margin-bottom: 30px;
        }

        .detailed-section.active {
            display: block;
        }

        .detailed-section h3 {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .detailed-section p {
            margin-bottom: 15px;
        }

        .back-btn {
            display: inline-block;
            color: var(--primary-color);
            font-weight: 500;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            color: var(--secondary-color);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-price {
            color: var(--secondary-color);
        }

        .cart-total {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            text-align: right;
        }

        .cart-actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
        }

        .analysis-cards {
            display: grid;
            gap: 15px;
        }

        .analysis-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }

        .analysis-card:hover {
            transform: translateY(-2px);
        }

        .analysis-card summary {
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            color: var(--secondary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .analysis-card summary::-webkit-details-marker {
            display: none;
        }

        .analysis-card summary::after {
            content: '▼';
            font-size: 12px;
            transition: transform 0.2s ease;
        }

        .analysis-card[open] summary::after {
            transform: rotate(180deg);
        }

        .analysis-card-content {
            margin-top: 10px;
            font-size: 14px;
        }

        .recommendation {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 10px;
        }

        .recommendation-buy {
            background-color: var(--success-color);
            color: white;
        }

        .recommendation-hold {
            background-color: var(--warning-color);
            color: white;
        }

        .recommendation-monitor {
            background-color: var(--danger-color);
            color: white;
        }

        .trend-chart {
            margin-top: 15px;
            padding: 10px;
            background-color: var(--gray-color);
            border-radius: 8px;
            height: 200px;
        }

        .trend-chart canvas {
            max-height: 100%;
            width: 100%;
        }

        /* Timeline Styles */
        .timeline {
            position: relative;
            margin: 20px 0;
            padding-left: 50px;
        }

        .timeline-step {
            position: relative;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease;
        }

        .timeline-step:hover {
            transform: scale(1.02);
        }

        .timeline-icon {
            position: absolute;
            left: -40px;
            top: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .timeline-step.completed .timeline-icon {
            background-color: var(--primary-color);
            color: white;
        }

        .timeline-step.current .timeline-icon {
            background-color: var(--secondary-color);
            color: white;
            border: 2px solid var(--primary-color);
            font-size: 18px;
        }

        .timeline-step.pending .timeline-icon {
            background-color: var(--gray-color);
            color: #757575;
        }

        .timeline-connector {
            position: absolute;
            left: -25px;
            top: 30px;
            bottom: -30px;
            width: 2px;
            background-color: var(--primary-color);
        }

        .timeline-step.pending .timeline-connector {
            background: linear-gradient(to bottom, var(--primary-color) 0%, var(--gray-color) 10%);
            background-color: var(--gray-color);
            border-left: 2px dashed #757575;
        }

        .timeline-step:last-child .timeline-connector {
            display: none;
        }

        .timeline-step h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .timeline-step.current h4 {
            color: var(--primary-color);
            font-weight: 700;
        }

        .timeline-step .date {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .timeline-step .description {
            font-size: 14px;
            color: var(--text-color);
        }

        /* Payment Modal */
        .modal {
            display: none;
            visibility: hidden;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.active {
            display: flex;
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-modal {
            cursor: pointer;
            font-size: 24px;
            color: #666;
        }

        .order-summary {
            margin-bottom: 20px;
        }

        .order-summary table {
            width: 100%;
            border-collapse: collapse;
        }

        .order-summary th, .order-summary td {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
            text-align: left;
        }

        .order-summary th {
            background-color: var(--gray-color);
            font-weight: 600;
            color: var(--secondary-color);
        }

        .order-summary-total {
            margin-top: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            text-align: right;
        }

        .payment-methods {
            margin-bottom: 20px;
        }

        .payment-methods label {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .payment-methods input[type="radio"] {
            margin-right: 10px;
        }

        .payment-actions {
            display: flex;
            gap: 10px;
        }

        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 20px 0;
        }

        .footer-content {
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .card-container {
                grid-template-columns: 1fr;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }

            .nav-links {
                position: fixed;
                top: 70px;
                left: -100%;
                flex-direction: column;
                background-color: white;
                width: 100%;
                text-align: center;
                transition: 0.3s;
                box-shadow: 0 10px 10px rgba(0, 0, 0, 0.1);
                padding: 20px 0;
                z-index: 1000;
            }

            .nav-links.active {
                left: 0;
            }

            .nav-links a {
                margin: 15px 0;
            }

            .hamburger {
                display: block;
            }

            .modal-content {
                margin: 0 15px;
                width: calc(100% - 30px);
            }

            .trend-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            }

            .trend-chart {
                height: 150px;
            }

            .timeline {
                padding-left: 40px;
            }

            .timeline-icon {
                width: 25px;
                height: 25px;
                left: -35px;
                font-size: 14px;
            }

            .timeline-step.current .timeline-icon {
                font-size: 16px;
            }

            .timeline-connector {
                left: -22px;
            }

            .timeline-step h4 {
                font-size: 14px;
            }

            .timeline-step .date,
            .timeline-step .description {
                font-size: 12px;
            }
        }

        @media (max-width: 576px) {
            .welcome-section h2 {
                font-size: 1.5rem;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }

            .product-image {
                height: 180px;
            }

            .payment-actions {
                flex-direction: column;
            }

            .payment-actions button {
                width: 100%;
            }

            .analysis-card {
                padding: 10px;
            }

            .trend-item {
                font-size: 12px;
            }

            .trend-chart {
                height: 120px;
            }

            .timeline {
                padding-left: 30px;
                margin: 15px 0;
            }

            .timeline-icon {
                width: 20px;
                height: 20px;
                left: -25px;
                font-size: 12px;
            }

            .timeline-step.current .timeline-icon {
                font-size: 14px;
            }

            .timeline-connector {
                left: -17px;
            }

            .timeline-step {
                margin-bottom: 20px;
            }

            .timeline-step h4 {
                font-size: 13px;
            }

            .timeline-step .date,
            .timeline-step .description {
                font-size: 11px;
            }
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 350px;
            background-color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            padding: 15px 20px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 9999;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            border-left: 4px solid var(--success-color);
        }

        .notification-info {
            border-left: 4px solid var(--info-color);
        }

        .notification-warning {
            border-left: 4px solid var(--warning-color);
        }

        .notification-error {
            border-left: 4px solid var(--danger-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="KrishiSetu Logo">
                    <h1>KrishiSetu</h1>
                </div>
                
                <button class="hamburger" id="hamburger">☰</button>
                
                <div class="nav-links" id="navLinks">
                    <a href = "{{ url_for('home') }}";>Home</a>
                    <a href="#" id="cartLink">Cart (0)</a>
                </div>
                
                <div class="user-menu">
                    <div class="user-icon" id="userMenuToggle">
                        👤 <span>John Doe</span>
                    </div>
                    <div class="dropdown-menu" id="userDropdown">
                        <a href = "{{ url_for('user_profile') }}";>My Profile</a>
                        <a href ="{{ url_for('logout') }}";>Logout</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="content-area">
                <!-- Welcome Section -->
                <div class="welcome-section">
                    <h2>Welcome back, John!</h2>
                    <p>Here's what's happening with agriculture markets today.</p>
                </div>

                <!-- Quick Stats Cards -->
                <div class="card-container">
                    <div class="card">
                        <div class="card-icon">📈</div>
                        <h3>Market Trends</h3>
                        <div class="trend-grid" id="trendGrid"></div>
                        <a href="#" class="card-link" data-section="market-trends">View Detailed Analysis</a>
                    </div>
                    <div class="card">
                        <div class="card-icon">🚚</div>
                        <h3>Recent Order</h3>
                        <p id="recentOrderText">Loading...</p>
                        <a href="#" class="card-link" data-section="track-order">Track Order</a>
                    </div>
                </div>

                <!-- Detailed Analysis Section -->
                <div class="detailed-section" id="market-trends">
                    <a href="#" class="back-btn" onclick="showMainContent()">Back to Dashboard</a>
                    <h3>Market Trends Analysis</h3>
                    <div id="marketTrendsContent"></div>
                </div>

                <!-- Track Order Section -->
                <div class="detailed-section" id="track-order">
                    <a href="#" class="back-btn" onclick="showMainContent()">Back to Dashboard</a>
                    <h3>Track Your Order</h3>
                    <div id="trackOrderContent"></div>
                </div>

                <!-- Cart Details Section -->
                <div class="detailed-section" id="cart-details">
                    <a href="#" class="back-btn" onclick="showMainContent()">Back to Dashboard</a>
                    <h3>Your Cart</h3>
                    <div id="cart-items"></div>
                    <div class="cart-total" id="cart-total">Total: ₹0</div>
                    <div class="cart-actions" id="cart-actions"></div>
                </div>

                <!-- Browse Products Section -->
                <div class="products-section">
                    <div class="section-header">
                        <h3>Browse Products</h3>
                    </div>
                    <div class="product-grid">
                        <div class="product-card">
                            <div class="product-image">
                                <img src="{{ url_for('static', filename='images/potatoes.jpeg') }}" alt="Organic Potatoes">
                                <span class="product-badge">Organic</span>
                            </div>
                            <div class="product-details">
                                <h4 class="product-title">Organic Potatoes</h4>
                                <p class="product-farm">Green Farms, UP</p>
                                <div class="product-price">
                                    <span class="price">₹25/kg</span>
                                    <span>Min: 5kg</span>
                                </div>
                                <div class="product-actions">
                                    <button class="btn btn-primary">Add to Cart</button>
                                    <button class="btn btn-outline">❤️</button>
                                </div>
                            </div>
                        </div>
                        <div class="product-card">
                            <div class="product-image">
                                <img src="{{ url_for('static', filename='images/onions.jpeg') }}" alt="Fresh Onions">
                            </div>
                            <div class="product-details">
                                <h4 class="product-title">Fresh Onions</h4>
                                <p class="product-farm">Patel Organics, Gujarat</p>
                                <div class="product-price">
                                    <span class="price">₹35/kg</span>
                                    <span>Min: 3kg</span>
                                </div>
                                <div class="product-actions">
                                    <button class="btn btn-primary">Add to Cart</button>
                                    <button class="btn btn-outline">❤️</button>
                                </div>
                            </div>
                        </div>
                        <div class="product-card">
                            <div class="product-image">
                                <img src="{{ url_for('static', filename='images/green_peas.jpeg') }}" alt="Green Peas">
                                <span class="product-badge">New</span>
                            </div>
                            <div class="product-details">
                                <h4 class="product-title">Green Peas</h4>
                                <p class="product-farm">Valley Farms, HP</p>
                                <div class="product-price">
                                    <span class="price">₹60/kg</span>
                                    <span>Min: 2kg</span>
                                </div>
                                <div class="product-actions">
                                    <button class="btn btn-primary">Add to Cart</button>
                                    <button class="btn btn-outline">❤️</button>
                                </div>
                            </div>
                        </div>
                    
                        <div class="product-card">
                            <div class="product-image">
                                <img src="{{ url_for('static', filename='images/basmati.jpeg') }}" alt="Organic Rice">
                                <span class="product-badge">Organic</span>
                            </div>
                            <div class="product-details">
                                <h4 class="product-title">Premium Basmati Rice</h4>
                                <p class="product-farm">Sharma Farms, Punjab</p>
                                <div class="product-price">
                                    <span class="price">₹95/kg</span>
                                    <span>Min: 5kg</span>
                                </div>
                                <div class="product-actions">
                                    <button class="btn btn-primary">Add to Cart</button>
                                    <button class="btn btn-outline">❤️</button>
                                </div>
                            </div>
                        </div>
                        <div class="product-card">
                            <div class="product-image">
                                <img src="{{ url_for('static', filename='images/tomato.jpeg') }}" alt="Fresh Tomatoes">
                            </div>
                            <div class="product-details">
                                <h4 class="product-title">Fresh Tomatoes</h4>
                                <p class="product-farm">Patel Organics, Gujarat</p>
                                <div class="product-price">
                                    <span class="price">₹40/kg</span>
                                    <span>Min: 2kg</span>
                                </div>
                                <div class="product-actions">
                                    <button class="btn btn-primary">Add to Cart</button>
                                    <button class="btn btn-outline">❤️</button>
                                </div>
                            </div>
                        </div>
                        <div class="product-card">
                            <div class="product-image">
                                <img src="{{ url_for('static', filename='images/wheat-flour.jpg') }}" alt="Wheat Flour">
                                <span class="product-badge">Best Seller</span>
                            </div>
                            <div class="product-details">
                                <h4 class="product-title">Whole Wheat Flour</h4>
                                <p class="product-farm">Grains India, MP</p>
                                <div class="product-price">
                                    <span class="price">₹55/kg</span>
                                    <span>Min: 10kg</span>
                                </div>
                                <div class="product-actions">
                                    <button class="btn btn-primary">Add to Cart</button>
                                    <button class="btn btn-outline">❤️</button>
                                </div>
                            </div>
                        </div>
                        <div class="product-card">
                            <div class="product-image">
                                <img src="{{ url_for('static', filename='images/apple.jpeg') }}" alt="Fresh Apples">
                            </div>
                            <div class="product-details">
                                <h4 class="product-title">Kashmir Apples</h4>
                                <p class="product-farm">Valley Orchards, J&K</p>
                                <div class="product-price">
                                    <span class="price">₹120/kg</span>
                                    <span>Min: 3kg</span>
                                </div>
                                <div class="product-actions">
                                    <button class="btn btn-primary">Add to Cart</button>
                                    <button class="btn btn-outline">❤️</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Prices -->
                <div class="market-prices">
                    <div class="section-header">
                        <h3>Today's Market Prices</h3>
                        
                    </div>
                    <table class="price-table">
                        <thead>
                            <tr>
                                <th>Crop</th>
                                <th>Current Price</th>
                                <th>Yesterday's Price</th>
                                <th>Trend</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Rice (Basmati)</td>
                                <td>₹95/kg</td>
                                <td>₹90/kg</td>
                                <td class="trending-up">↑ 5.5%</td>
                            </tr>
                            <tr>
                                <td>Wheat</td>
                                <td>₹32/kg</td>
                                <td>₹33/kg</td>
                                <td class="trending-down">↓ 3.0%</td>
                            </tr>
                            <tr>
                                <td>Tomatoes</td>
                                <td>₹40/kg</td>
                                <td>₹45/kg</td>
                                <td class="trending-down">↓ 11.1%</td>
                            </tr>
                            <tr>
                                <td>Onions</td>
                                <td>₹35/kg</td>
                                <td>₹32/kg</td>
                                <td class="trending-up">↑ 9.4%</td>
                            </tr>
                            <tr>
                                <td>Potatoes</td>
                                <td>₹25/kg</td>
                                <td>₹25/kg</td>
                                <td>→ 0.0%</td>
                            </tr>
                            <tr>
                                <td>Pulses (Moong Dal)</td>
                                <td>₹80/kg</td>
                                <td>₹78/kg</td>
                                <td class="trending-up">↑ 2.6%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Complete Your Payment</h2>
                <span class="close-modal" id="closePayment">×</span>
            </div>
            <div class="payment-content">
                <div class="order-summary">
                    <h4>Order Summary</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="orderSummaryBody"></tbody>
                    </table>
                    <div class="order-summary-total" id="orderSummaryTotal">Total: ₹0</div>
                </div>
                <form id="paymentForm">
                    <div class="payment-methods">
                        <h4>Select Payment Method</h4>
                        <label><input type="radio" name="paymentMethod" value="upi"> UPI</label>
                        <label><input type="radio" name="paymentMethod" value="card"> Credit/Debit Card</label>
                        <label><input type="radio" name="paymentMethod" value="netbanking"> Net Banking</label>
                        <label><input type="radio" name="paymentMethod" value="cod"> Cash on Delivery</label>
                    </div>
                    <div class="payment-actions">
                        <button type="submit" class="btn btn-primary">Confirm Payment</button>
                        <button type="button" class="btn btn-cancel" id="cancelPayment">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <p>© 2025 KrishiSetu. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Initialize cart and chart instances
        let cart = [];
        let userData = {};
        let chartInstances = [];

        // Toggle Navigation Menu
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        
        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        // User Menu Toggle
        const userMenuToggle = document.getElementById('userMenuToggle');
        const userDropdown = document.getElementById('userDropdown');
        
        userMenuToggle.addEventListener('click', () => {
            userDropdown.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        window.addEventListener('click', (e) => {
            if (!userMenuToggle.contains(e.target) && !userDropdown.contains(e.target)) {
                userDropdown.classList.remove('active');
            }
        });

        // Modal handling
        const paymentModal = document.getElementById('paymentModal');
        const closePayment = document.getElementById('closePayment');
        const cancelPayment = document.getElementById('cancelPayment');

        function openModal(modal) {
            console.log('Opening payment modal');
            if (cart.length === 0) {
                console.warn('Attempted to open payment modal with empty cart');
                showNotification('Cart is empty. Add items to proceed to checkout.', 'error');
                return;
            }
            modal.classList.add('active');
        }

        function closeModal(modal) {
            console.log('Closing payment modal');
            modal.classList.remove('active');
        }

        closePayment.addEventListener('click', () => closeModal(paymentModal));
        cancelPayment.addEventListener('click', () => closeModal(paymentModal));

        // Add to Cart Functionality
        const addToCartButtons = document.querySelectorAll('.btn-primary');
        
        addToCartButtons.forEach(button => {
            button.addEventListener('click', function() {
                const productDetails = this.closest('.product-details');
                const productName = productDetails.querySelector('.product-title').textContent;
                const productPrice = parseFloat(productDetails.querySelector('.price').textContent.replace('₹', '').replace('/kg', ''));
                const minQuantity = parseInt(productDetails.querySelector('.product-price span:last-child').textContent.replace('Min: ', '').replace('kg', ''));

                // Add item to cart
                cart.push({
                    name: productName,
                    price: productPrice,
                    quantity: minQuantity
                });

                // Update cart count
                const cartLink = document.getElementById('cartLink');
                cartLink.textContent = `Cart (${cart.length})`;

                showNotification(`${productName} added to cart!`, 'success');
            });
        });

        // Wishlist Functionality
        const wishlistButtons = document.querySelectorAll('.btn-outline');
        
        wishlistButtons.forEach(button => {
            button.addEventListener('click', function() {
                this.textContent = this.textContent === '❤️' ? '❤️ Saved' : '❤️';
                const productName = this.closest('.product-details').querySelector('.product-title').textContent;
                
                if (this.textContent === '❤️ Saved') {
                    showNotification(`${productName} added to wishlist!`, 'success');
                } else {
                    showNotification(`${productName} removed from wishlist!`, 'info');
                }
            });
        });

        // Show Detailed Analysis, Track Order, or Cart Details
        const cardLinks = document.querySelectorAll('.card-link');
        const cartLink = document.getElementById('cartLink');
        const mainSections = document.querySelectorAll('.welcome-section, .card-container, .products-section, .market-prices');
        const detailedSections = document.querySelectorAll('.detailed-section');

        cardLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-section');
                showDetailedSection(sectionId);
            });
        });

        cartLink.addEventListener('click', function(e) {
            e.preventDefault();
            showDetailedSection('cart-details');
            updateCartDetails();
        });

        function showDetailedSection(sectionId) {
            // Hide main content
            mainSections.forEach(section => section.style.display = 'none');
            // Show detailed section
            detailedSections.forEach(section => section.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            if (sectionId === 'track-order') {
                updateTrackOrder();
            }
        }

        // Show Main Content (Back Button)
        window.showMainContent = function() {
            mainSections.forEach(section => section.style.display = 'block');
            detailedSections.forEach(section => section.classList.remove('active'));
        };

        // Update Cart Details
        function updateCartDetails() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalElement = document.getElementById('cart-total');
            const cartActionsContainer = document.getElementById('cart-actions');
            cartItemsContainer.innerHTML = '';

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
                cartTotalElement.textContent = 'Total: ₹0';
                cartActionsContainer.innerHTML = '';
                return;
            }

            let total = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <span class="cart-item-name">${item.name} (${item.quantity}kg)</span>
                    <span class="cart-item-price">₹${itemTotal}</span>
                `;
                cartItemsContainer.appendChild(cartItem);
            });

            cartTotalElement.textContent = `Total: ₹${total}`;
            cartActionsContainer.innerHTML = `
                <button class="btn btn-primary" id="proceedToCheckout">Proceed to Checkout</button>
            `;
        }

        // Event delegation for Proceed to Checkout
        document.addEventListener('click', (e) => {
            if (e.target.id === 'proceedToCheckout') {
                console.log('Proceed to Checkout clicked, cart length:', cart.length);
                if (cart.length === 0) {
                    showNotification('Cart is empty. Add items to proceed to checkout.', 'error');
                    return;
                }
                renderOrderSummary();
                openModal(paymentModal);
            }
        });

        // Render Order Summary in Payment Modal
        function renderOrderSummary() {
            const orderSummaryBody = document.getElementById('orderSummaryBody');
            const orderSummaryTotal = document.getElementById('orderSummaryTotal');
            orderSummaryBody.innerHTML = '';

            let total = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity} kg</td>
                    <td>₹${item.price}/kg</td>
                    <td>₹${itemTotal}</td>
                `;
                orderSummaryBody.appendChild(row);
            });

            orderSummaryTotal.textContent = `Total: ₹${total}`;
        }

        // Payment Form Submission
        const paymentForm = document.getElementById('paymentForm');
        paymentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');

            if (!paymentMethod) {
                showNotification('Please select a payment method.', 'error');
                return;
            }

            // Clear cart
            cart = [];
            document.getElementById('cartLink').textContent = `Cart (0)`;
            showNotification('Order placed successfully!', 'success');
            closeModal(paymentModal);
            showMainContent();
            updateCartDetails();
        });

        // Simple notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-message">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Generate Market Trends Analysis with Chart.js
        function generateMarketTrends() {
            const priceRows = document.querySelectorAll('.price-table tbody tr');
            const trendsContent = document.getElementById('marketTrendsContent');
            const trendGrid = document.getElementById('trendGrid');
            let analysis = '<h4>Current Market Insights</h4><div class="analysis-cards">';
            let trendGridHtml = '';
            const trends = [];

            // Destroy existing charts to prevent memory leaks
            chartInstances.forEach(chart => chart.destroy());
            chartInstances = [];

            priceRows.forEach((row, index) => {
                const crop = row.cells[0].textContent;
                const currentPrice = parseFloat(row.cells[1].textContent.replace('₹', '').replace('/kg', ''));
                const previousPrice = parseFloat(row.cells[2].textContent.replace('₹', '').replace('/kg', ''));
                const trend = row.cells[3].textContent;
                const percentChange = parseFloat(trend.match(/[\d.]+/)[0]);
                let recommendation = '';
                let recommendationClass = '';

                if (percentChange > 2) {
                    recommendation = 'Monitor: Prices are rising; consider delaying purchases.';
                    recommendationClass = 'recommendation-monitor';
                } else if (percentChange < -2) {
                    recommendation = 'Buy now: Prices have dropped significantly.';
                    recommendationClass = 'recommendation-buy';
                } else {
                    recommendation = 'Hold: Prices are stable.';
                    recommendationClass = 'recommendation-hold';
                }

                // Update trend grid for card
                const trendClass = percentChange > 0 ? 'trending-up' : percentChange < 0 ? 'trending-down' : 'trending-stable';
                const trendIcon = percentChange > 0 ? '↑' : percentChange < 0 ? '↓' : '→';
                trendGridHtml += `
                    <div class="trend-item ${trendClass}">
                        <span>${trendIcon}</span> ${crop}
                        <div class="trend-tooltip">${trend}</div>
                    </div>
                `;

                // Update detailed analysis
                const canvasId = `priceChart-${index}`;
                analysis += `
                    <details class="analysis-card">
                        <summary>${crop} (${trend})</summary>
                        <div class="analysis-card-content">
                            <p>Current Price: ₹${currentPrice}/kg</p>
                            <p>Yesterday's Price: ₹${previousPrice}/kg</p>
                            <p class="recommendation ${recommendationClass}">${recommendation}</p>
                            <div class="trend-chart">
                                <canvas id="${canvasId}"></canvas>
                            </div>
                        </div>
                    </details>
                `;
                trends.push({ crop, currentPrice, trend, canvasId });
            });

            trendGrid.innerHTML = trendGridHtml;
            trendsContent.innerHTML = analysis + '</div>';

            // Simulate historical prices for charts (5 days)
            const chartData = trends.map(item => {
                const prices = [item.currentPrice];
                for (let i = 0; i < 4; i++) {
                    const fluctuation = (Math.random() * 5 - 2.5).toFixed(1);
                    prices.unshift(prices[0] + parseFloat(fluctuation));
                }
                return { crop: item.crop, prices, canvasId: item.canvasId };
            });

            // Generate Chart.js line charts
            chartData.forEach(item => {
                const ctx = document.getElementById(item.canvasId).getContext('2d');
                const minPrice = Math.min(...item.prices) * 0.95;
                const maxPrice = Math.max(...item.prices) * 1.05;

                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'],
                        datasets: [{
                            label: `${item.crop} Price (₹/kg)`,
                            data: item.prices,
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.2)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: '#212121',
                                titleFont: { size: 12 },
                                bodyFont: { size: 12 },
                                callbacks: {
                                    label: (context) => `₹${context.parsed.y.toFixed(1)}/kg`
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                title: {
                                    display: true,
                                    text: 'Day',
                                    color: '#333',
                                    font: { size: 12 }
                                },
                                ticks: { font: { size: 10 } }
                            },
                            y: {
                                grid: { color: '#e0e0e0' },
                                title: {
                                    display: true,
                                    text: 'Price (₹/kg)',
                                    color: '#333',
                                    font: { size: 12 }
                                },
                                ticks: { font: { size: 10 } },
                                suggestedMin: minPrice,
                                suggestedMax: maxPrice
                            }
                        }
                    }
                });
                chartInstances.push(chart);
            });
        }

        // Update Track Order Section with Timeline
        function updateTrackOrder() {
            const trackOrderContent = document.getElementById('trackOrderContent');
            const recentOrder = userData.recentOrders[0];
            if (!recentOrder) {
                trackOrderContent.innerHTML = '<p>No orders found.</p>';
                return;
            }

            const statusSteps = [
                { name: 'Ordered', description: 'Order placed successfully' },
                { name: 'Processing', description: 'Order is being prepared' },
                { name: 'Shipped', description: 'Order has been shipped' },
                { name: 'Out for Delivery', description: 'Order is out for delivery' },
                { name: 'Delivered', description: 'Order has been delivered' }
            ];
            const currentStep = statusSteps.findIndex(step => step.name === recentOrder.status);

            // Simulate timestamps starting from orderDate
            const orderDate = new Date(recentOrder.orderDate);
            const timelines = statusSteps.map((step, index) => {
                const stepDate = new Date(orderDate);
                stepDate.setHours(orderDate.getHours() + index * 6); // Increment by 6 hours per step
                const formattedDate = stepDate.toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                return {
                    ...step,
                    date: index <= currentStep ? formattedDate : 'Pending',
                    status: index < currentStep ? 'completed' : index === currentStep ? 'current' : 'pending'
                };
            });

            // Generate timeline HTML
            const timelineHtml = timelines.map(timeline => `
                <div class="timeline-step ${timeline.status}">
                    <div class="timeline-icon">${timeline.status === 'completed' ? '✓' : '○'}</div>
                    <h4>${timeline.name}</h4>
                    <div class="date">${timeline.date}</div>
                    <div class="description">${timeline.description}</div>
                    <div class="timeline-connector"></div>
                </div>
            `).join('');

            const itemsHtml = recentOrder.items.map(item => `
                <li>${item.name} (${item.quantity}kg) - ₹${(item.price * item.quantity).toFixed(0)}</li>
            `).join('');

            trackOrderContent.innerHTML = `
                <p><strong>Order #${recentOrder.id}</strong></p>
                <p>Order Date: ${recentOrder.orderDate}</p>
                <p>Status: ${recentOrder.status}</p>
                <div class="timeline">${timelineHtml}</div>
                <p>Shipping Address: ${recentOrder.address}</p>
                <p>Payment Status: ${recentOrder.paymentStatus}</p>
                <p>Items:</p>
                <ul>${itemsHtml}</ul>
                <p>Total: ₹${recentOrder.total.toFixed(0)}</p>
                ${recentOrder.status !== 'Delivered' ? `<button class="btn btn-cancel-order" onclick="cancelOrder('${recentOrder.id}')">Cancel Order</button>` : ''}
            `;
        }

        // Cancel Order
        window.cancelOrder = function(orderId) {
            userData.recentOrders = userData.recentOrders.filter(order => order.id !== orderId);
            showNotification(`Order #${orderId} cancelled successfully.`, 'success');
            updateTrackOrder();
            updateRecentOrderCard();
        };

        // Update Recent Order Card
        function updateRecentOrderCard() {
            const recentOrderText = document.getElementById('recentOrderText');
            const recentOrder = userData.recentOrders[0];
            if (recentOrder) {
                recentOrderText.textContent = `Order #${recentOrder.id} (${recentOrder.status}), Placed on ${recentOrder.orderDate}`;
            } else {
                recentOrderText.textContent = 'No recent orders.';
            }
        }

        // Simulate changing market prices
        function updateMarketPrices() {
            const priceRows = document.querySelectorAll('.price-table tbody tr');
            
            priceRows.forEach(row => {
                const currentPrice = parseFloat(row.cells[1].textContent.replace('₹', '').replace('/kg', ''));
                const previousPrice = parseFloat(row.cells[2].textContent.replace('₹', '').replace('/kg', ''));
                
                // Random price fluctuation
                const fluctuation = (Math.random() * 3 - 1).toFixed(1);
                const newPrice = (currentPrice + parseFloat(fluctuation)).toFixed(0);
                
                // Update prices
                row.cells[2].textContent = `₹${currentPrice}/kg`;
                row.cells[1].textContent = `₹${newPrice}/kg`;
                
                // Calculate percentage change
                const percentChange = (((newPrice - currentPrice) / currentPrice) * 100).toFixed(1);
                
                // Update trend cell
                const trendCell = row.cells[3];
                if (parseFloat(percentChange) > 0) {
                    trendCell.textContent = `↑ ${Math.abs(percentChange)}%`;
                    trendCell.className = 'trending-up';
                } else if (parseFloat(percentChange) < 0) {
                    trendCell.textContent = `↓ ${Math.abs(percentChange)}%`;
                    trendCell.className = 'trending-down';
                } else {
                    trendCell.textContent = `→ 0.0%`;
                    trendCell.className = '';
                }
            });

            // Update market trends analysis and charts
            generateMarketTrends();
        }

        // Initialize page with dynamic content
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            const formattedDate = today.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Load user data
            loadUserData();
            generateMarketTrends();
            // Ensure modal is closed on load
            closeModal(paymentModal);
        });

        // Simulate loading user data
        function loadUserData() {
            userData = {
                name: "John Doe",
                location: "New Delhi, India",
                lastLogin: "Yesterday at 18:45",
                notifications: 3,
                recentOrders: [
                    {
                        id: "2459",
                        status: "Out for Delivery",
                        orderDate: "May 8, 2025",
                        items: [
                            { name: "Premium Basmati Rice", quantity: 5, price: 95 },
                            { name: "Fresh Tomatoes", quantity: 2, price: 40 }
                        ],
                        total: 555,
                        address: "123 Green Avenue, New Delhi, 110001",
                        paymentStatus: "Paid"
                    },
                    {
                        id: "2458",
                        status: "Delivered",
                        orderDate: "May 5, 2025",
                        items: [
                            { name: "Whole Wheat Flour", quantity: 10, price: 55 }
                        ],
                        total: 550,
                        address: "123 Green Avenue, New Delhi, 110001",
                        paymentStatus: "Paid"
                    },
                    {
                        id: "2457",
                        status: "Processing",
                        orderDate: "May 3, 2025",
                        items: [
                            { name: "Organic Potatoes", quantity: 5, price: 25 }
                        ],
                        total: 125,
                        address: "123 Green Avenue, New Delhi, 110001",
                        paymentStatus: "Pending"
                    }
                ]
            };
            
            // Update welcome message
            document.querySelector('.welcome-section h2').textContent = `Welcome back, ${userData.name}!`;
            
            // Update recent order card
            updateRecentOrderCard();
        }

        // Update market prices every 5 minutes
        setInterval(updateMarketPrices, 300000);
    </script>
</body>
</html>